import{r as A,d as _,j as s}from"./index-CAmiuzXs.js";import{c as P}from"./useGetClassName-I7XXwiyH.js";import{u as xe}from"./useGetClassName-CCqDzdPG.js";var K={},le={},V={};Object.defineProperty(V,"__esModule",{value:!0});const se=A;function we(e,r,o){const n=o==="session"?sessionStorage:localStorage,[f,t]=(0,se.useState)(()=>{const c=n.getItem(e);try{return c?JSON.parse(c):r}catch{return console.warn(`Failed to parse stored value for '${e}'.
Continuing with default value.`),r}}),a=c=>{if(c===void 0){t(c),n.removeItem(e);return}try{const p=c instanceof Function?c(f):c;t(p),n.setItem(e,JSON.stringify(p))}catch{console.error(`Failed to store value '${c}' for key '${e}'`)}};return(0,se.useEffect)(()=>{const c=p=>{var g;if(p.storageArea===n&&p.key===e)if(p.newValue===null)t(void 0);else try{t(JSON.parse((g=p.newValue)!==null&&g!==void 0?g:""))}catch{console.warn(`Failed to handle storageEvent's newValue='${p.newValue}' for key '${e}'`)}};return window.addEventListener("storage",c,!1),()=>window.removeEventListener("storage",c,!1)}),[f,a]}V.default=we;var C={};Object.defineProperty(C,"__esModule",{value:!0});C.validateConfig=C.createInternalConfig=void 0;function F(e){return["",void 0,null].includes(e)}function ke(e){const{autoLogin:r=!0,clearURL:o=!0,decodeToken:n=!0,scope:f=void 0,preLogin:t=()=>null,postLogin:a=()=>null,onRefreshTokenExpire:c=void 0,storage:p="local",storageKeyPrefix:g="ROCP_",refreshWithScope:m=!0}=e,d=Object.assign(Object.assign({},e),{autoLogin:r,clearURL:o,decodeToken:n,scope:f,preLogin:t,postLogin:a,onRefreshTokenExpire:c,storage:p,storageKeyPrefix:g,refreshWithScope:m});return de(d),d}C.createInternalConfig=ke;function de(e){if(F(e==null?void 0:e.clientId))throw Error("'clientId' must be set in the 'AuthConfig' object passed to 'react-oauth2-code-pkce' AuthProvider");if(F(e==null?void 0:e.authorizationEndpoint))throw Error("'authorizationEndpoint' must be set in the 'AuthConfig' object passed to 'react-oauth2-code-pkce' AuthProvider");if(F(e==null?void 0:e.tokenEndpoint))throw Error("'tokenEndpoint' must be set in the 'AuthConfig' object passed to 'react-oauth2-code-pkce' AuthProvider");if(F(e==null?void 0:e.redirectUri))throw Error("'redirectUri' must be set in the 'AuthConfig' object passed to 'react-oauth2-code-pkce' AuthProvider");if(!["session","local"].includes(e.storage))throw Error("'storage' must be one of ('session', 'local')");e!=null&&e.extraAuthParams&&console.warn("The 'extraAuthParams' configuration parameter will be deprecated. You should use 'extraTokenParameters' instead."),e!=null&&e.extraAuthParams&&(e!=null&&e.extraTokenParameters)&&console.warn("Using both 'extraAuthParams' and 'extraTokenParameters' is not recommended. They do the same thing, and you should only use 'extraTokenParameters'")}C.validateConfig=de;var x={},O={},S={};Object.defineProperty(S,"__esModule",{value:!0});S.FetchError=void 0;class Ee extends Error{constructor(r,o,n){super(n),this.name="FetchError",this.status=r,this.statusText=o}}S.FetchError=Ee;var ie=_&&_.__awaiter||function(e,r,o,n){function f(t){return t instanceof o?t:new o(function(a){a(t)})}return new(o||(o=Promise))(function(t,a){function c(m){try{g(n.next(m))}catch(d){a(d)}}function p(m){try{g(n.throw(m))}catch(d){a(d)}}function g(m){m.done?t(m.value):f(m.value).then(c,p)}g((n=n.apply(e,r||[])).next())})};Object.defineProperty(O,"__esModule",{value:!0});O.postWithXForm=void 0;const ye=S;function Te(e){let r="";for(const[o,n]of Object.entries(e))r+=`${r?"&":""}${o}=${encodeURIComponent(n)}`;return r}function Pe(e,r){return ie(this,void 0,void 0,function*(){return fetch(e,{method:"POST",body:Te(r),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(o=>ie(this,void 0,void 0,function*(){if(!o.ok){const n=yield o.text();throw new ye.FetchError(o.status,o.statusText,n)}return o}))})}O.postWithXForm=Pe;var E={},je=_&&_.__awaiter||function(e,r,o,n){function f(t){return t instanceof o?t:new o(function(a){a(t)})}return new(o||(o=Promise))(function(t,a){function c(m){try{g(n.next(m))}catch(d){a(d)}}function p(m){try{g(n.throw(m))}catch(d){a(d)}}function g(m){m.done?t(m.value):f(m.value).then(c,p)}g((n=n.apply(e,r||[])).next())})};Object.defineProperty(E,"__esModule",{value:!0});E.generateCodeChallenge=E.generateRandomString=E.getRandomInteger=void 0;function J(e){const o=new Uint8Array(1);return window.crypto.getRandomValues(o),o[0]>=Math.floor(256/e)*e?J(e):o[0]%e}E.getRandomInteger=J;function Ie(e){let r="";const o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<e;n++)r+=o.charAt(J(o.length-1));return r}E.generateRandomString=Ie;function Ne(e){var r;return je(this,void 0,void 0,function*(){if(!(!((r=window.crypto.subtle)===null||r===void 0)&&r.digest))throw new Error("The context/environment is not secure, and does not support the 'crypto.subtle' module. See: https://developer.mozilla.org/en-US/docs/Web/API/Crypto/subtle for details");const n=new TextEncoder().encode(e),f=yield window.crypto.subtle.digest("SHA-256",n),t=String.fromCharCode(...new Uint8Array(f));return btoa(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")})}E.generateCodeChallenge=Ne;var Ae=_&&_.__awaiter||function(e,r,o,n){function f(t){return t instanceof o?t:new o(function(a){a(t)})}return new(o||(o=Promise))(function(t,a){function c(m){try{g(n.next(m))}catch(d){a(d)}}function p(m){try{g(n.throw(m))}catch(d){a(d)}}function g(m){m.done?t(m.value):f(m.value).then(c,p)}g((n=n.apply(e,r||[])).next())})};Object.defineProperty(x,"__esModule",{value:!0});x.validateState=x.redirectToLogout=x.fetchWithRefreshToken=x.fetchTokens=x.redirectToLogin=void 0;const Ce=O,ce=E,ue="PKCE_code_verifier",W="ROCP_auth_state";function Se(e,r){return Ae(this,void 0,void 0,function*(){const o=e.storage==="session"?sessionStorage:localStorage,n=(0,ce.generateRandomString)(96);return o.setItem(ue,n),(0,ce.generateCodeChallenge)(n).then(f=>{const t=new URLSearchParams(Object.assign({response_type:"code",client_id:e.clientId,redirect_uri:e.redirectUri,code_challenge:f,code_challenge_method:"S256"},e.extraAuthParameters));e.scope!==void 0&&t.append("scope",e.scope),o.removeItem(W);const a=r??e.state;a&&(o.setItem(W,a),t.append("state",a)),e!=null&&e.preLogin&&e.preLogin(),window.location.assign(`${e.authorizationEndpoint}?${t.toString()}`)})})}x.redirectToLogin=Se;function Re(e){return e.access_token!==void 0}function fe(e,r){return(0,Ce.postWithXForm)(e,r).then(o=>o.json().then(n=>{if(Re(n))return n;throw Error(JSON.stringify(n))}))}const Le=e=>{const r=e.storage==="session"?sessionStorage:localStorage,n=new URLSearchParams(window.location.search).get("code"),f=r.getItem(ue);if(!n)throw Error(`Parameter 'code' not found in URL. 
Has authentication taken place?`);if(!f)throw Error(`Can't get tokens without the CodeVerifier. 
Has authentication taken place?`);const t=Object.assign(Object.assign({grant_type:"authorization_code",code:n,client_id:e.clientId,redirect_uri:e.redirectUri,code_verifier:f},e.extraTokenParameters),e.extraAuthParams);return fe(e.tokenEndpoint,t)};x.fetchTokens=Le;const Fe=e=>{const{config:r,refreshToken:o}=e,n=Object.assign({grant_type:"refresh_token",refresh_token:o,client_id:r.clientId,redirect_uri:r.redirectUri},r.extraTokenParameters);return r.refreshWithScope&&(n.scope=r.scope),fe(r.tokenEndpoint,n)};x.fetchWithRefreshToken=Fe;function Oe(e,r,o,n,f,t){var a;const c=new URLSearchParams(Object.assign({token:o||r,token_type_hint:o?"refresh_token":"access_token",client_id:e.clientId,post_logout_redirect_uri:(a=e.logoutRedirect)!==null&&a!==void 0?a:e.redirectUri,ui_locales:window.navigator.languages.join(" ")},e.extraLogoutParameters));n&&c.append("id_token_hint",n),f&&c.append("state",f),t&&c.append("logout_hint",t),window.location.assign(`${e.logoutEndpoint}?${c.toString()}`)}x.redirectToLogout=Oe;function Ue(e,r){const o=r==="session"?sessionStorage:localStorage,n=e.get("state"),f=o.getItem(W);if(n!==f)throw new Error('"state" value received from authentication server does no match client request. Possible cross-site request forgery')}x.validateState=Ue;var U={};Object.defineProperty(U,"__esModule",{value:!0});U.decodeJWT=void 0;const Me=e=>{try{const o=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(o).split("").map(f=>`%${`00${f.charCodeAt(0).toString(16)}`.slice(-2)}`).join(""));return JSON.parse(n)}catch(r){throw console.error(r),Error(`Failed to decode the access token.
	Is it a proper JSON Web Token?
	You can disable JWT decoding by setting the 'decodeToken' value to 'false' the configuration.`)}};U.decodeJWT=Me;var he={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getRefreshExpiresIn=e.epochTimeIsPast=e.epochAtSecondsFromNow=e.FALLBACK_EXPIRE_TIME=void 0,e.FALLBACK_EXPIRE_TIME=600;const r=t=>Math.round(Date.now()/1e3+Number(t));e.epochAtSecondsFromNow=r;function o(t){return Math.round(Date.now())/1e3+30>=t}e.epochTimeIsPast=o;const n=["refresh_expires_in","refresh_token_expires_in"];function f(t,a){for(const c of n)if(c in a)return a[c];return a.refresh_token?t+e.FALLBACK_EXPIRE_TIME:t}e.getRefreshExpiresIn=f})(he);(function(e){var r=_&&_.__createBinding||(Object.create?function(l,v,i,b){b===void 0&&(b=i);var w=Object.getOwnPropertyDescriptor(v,i);(!w||("get"in w?!v.__esModule:w.writable||w.configurable))&&(w={enumerable:!0,get:function(){return v[i]}}),Object.defineProperty(l,b,w)}:function(l,v,i,b){b===void 0&&(b=i),l[b]=v[i]}),o=_&&_.__setModuleDefault||(Object.create?function(l,v){Object.defineProperty(l,"default",{enumerable:!0,value:v})}:function(l,v){l.default=v}),n=_&&_.__importStar||function(l){if(l&&l.__esModule)return l;var v={};if(l!=null)for(var i in l)i!=="default"&&Object.prototype.hasOwnProperty.call(l,i)&&r(v,l,i);return o(v,l),v},f=_&&_.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(e,"__esModule",{value:!0}),e.AuthProvider=e.AuthContext=void 0;const t=n(A),a=f(V),c=C,p=x,g=U,m=S,d=he;e.AuthContext=(0,t.createContext)({token:"",login:()=>null,logOut:()=>null,error:null,loginInProgress:!1});const j=({authConfig:l,children:v})=>{const i=(0,t.useMemo)(()=>(0,c.createInternalConfig)(l),[l]),[b,w]=(0,a.default)(`${i.storageKeyPrefix}refreshToken`,void 0,i.storage),[q,X]=(0,a.default)(`${i.storageKeyPrefix}refreshTokenExpire`,(0,d.epochAtSecondsFromNow)(2*d.FALLBACK_EXPIRE_TIME),i.storage),[k,z]=(0,a.default)(`${i.storageKeyPrefix}token`,"",i.storage),[H,G]=(0,a.default)(`${i.storageKeyPrefix}tokenExpire`,(0,d.epochAtSecondsFromNow)(d.FALLBACK_EXPIRE_TIME),i.storage),[R,Y]=(0,a.default)(`${i.storageKeyPrefix}idToken`,void 0,i.storage),[Q,L]=(0,a.default)(`${i.storageKeyPrefix}loginInProgress`,!1,i.storage),[me,Z]=(0,a.default)(`${i.storageKeyPrefix}refreshInProgress`,!1,i.storage),[pe,M]=(0,t.useState)(),[ge,$]=(0,t.useState)(),[ve,y]=(0,t.useState)(null);function D(){w(void 0),z(""),G((0,d.epochAtSecondsFromNow)(d.FALLBACK_EXPIRE_TIME)),X((0,d.epochAtSecondsFromNow)(d.FALLBACK_EXPIRE_TIME)),Y(void 0),M(void 0),$(void 0),L(!1)}function _e(u,h){D(),y(null),i!=null&&i.logoutEndpoint&&k&&(0,p.redirectToLogout)(i,k,b,R,u,h)}function T(u){D(),L(!0);let h=u;u&&typeof u!="string"&&(console.warn(`Passed login state must be of type 'string'. Received '${u}'. Ignoring value...`),h=void 0),(0,p.redirectToLogin)(i,h).catch(I=>{console.error(I),y(I.message),L(!1)})}function ee(u){var h,I,B;z(u.access_token);let ne=d.FALLBACK_EXPIRE_TIME;try{if(u.id_token){const N=(0,g.decodeJWT)(u.id_token);$(N),ne=Math.round(Number(N.exp)-Date.now()/1e3)}}catch(N){console.warn(`Failed to decode idToken: ${N.message}`)}const ae=(I=(h=i.tokenExpiresIn)!==null&&h!==void 0?h:u.expires_in)!==null&&I!==void 0?I:ne;G((0,d.epochAtSecondsFromNow)(ae));const be=(B=i.refreshTokenExpiresIn)!==null&&B!==void 0?B:(0,d.getRefreshExpiresIn)(ae,u);u.refresh_token&&(w(u.refresh_token),X((0,d.epochAtSecondsFromNow)(be))),Y(u.id_token);try{i.decodeToken&&M((0,g.decodeJWT)(u.access_token))}catch(N){console.warn(`Failed to decode access token: ${N.message}`)}}function te(u=!1){if(u){T();return}if(!i.onRefreshTokenExpire){T();return}i.onRefreshTokenExpire({login:T})}function re(u=!1){if(k&&(0,d.epochTimeIsPast)(H)&&!(me&&!u)){if((0,d.epochTimeIsPast)(q)){te(u);return}if(b){Z(!0),(0,p.fetchWithRefreshToken)({config:i,refreshToken:b}).then(h=>ee(h)).catch(h=>{if(h instanceof m.FetchError){if(h.status===400){te(u);return}console.error(h),y(h.message),u&&T()}else h instanceof Error&&(console.error(h),y(h.message),u&&T())}).finally(()=>{Z(!1)});return}console.warn("Failed to refresh access_token. Most likely there is no refresh_token, or the authentication server did not reply with an explicit expire time, and the default expire times are longer than the actual tokens expire time")}}(0,t.useEffect)(()=>{const u=1e4*Math.random(),h=setInterval(()=>re(),5e3+u);return()=>clearInterval(h)},[k,b,q,H]);const oe=(0,t.useRef)(!1);return(0,t.useEffect)(()=>{if(Q){const u=new URLSearchParams(window.location.search);if(!u.get("code")){const h=u.get("error_description")||"Bad authorization state. Refreshing the page and log in again might solve the issue.";console.error(`${h}
Expected  to find a '?code=' parameter in the URL by now. Did the authentication get aborted or interrupted?`),y(h),D();return}if(!oe.current){oe.current=!0;try{(0,p.validateState)(u,i.storage)}catch(h){console.error(h),y(h.message)}(0,p.fetchTokens)(i).then(h=>{ee(h),i!=null&&i.postLogin&&i.postLogin()}).catch(h=>{console.error(h),y(h.message)}).finally(()=>{i.clearURL&&window.history.replaceState(null,"",window.location.pathname),L(!1)})}return}if(!k&&i.autoLogin)return T();try{R&&$((0,g.decodeJWT)(R))}catch(u){console.warn(`Failed to decode idToken: ${u.message}`)}try{k&&i.decodeToken&&M((0,g.decodeJWT)(k))}catch(u){console.warn(`Failed to decode access token: ${u.message}`)}re(!0)},[]),t.default.createElement(e.AuthContext.Provider,{value:{token:k,tokenData:pe,idToken:R,idTokenData:ge,login:T,logOut:_e,error:ve,loginInProgress:Q}},v)};e.AuthProvider=j})(le);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AuthContext=e.AuthProvider=void 0;var r=le;Object.defineProperty(e,"AuthProvider",{enumerable:!0,get:function(){return r.AuthProvider}}),Object.defineProperty(e,"AuthContext",{enumerable:!0,get:function(){return r.AuthContext}})})(K);const $e="account-console",De="http://localhost:8080/realms/master/protocol/openid-connect/auth",Be="http://localhost:8080/realms/master/protocol/openid-connect/token",We="http://localhost:8080/realms/master/account/",Ke="profile openid",Ve="http://localhost:8080/realms/master/account/?userProfileMetadata=true",Je={clientId:$e,authorizationEndpoint:De,tokenEndpoint:Be,redirectUri:We,scope:Ke,onRefreshTokenExpire:e=>window.confirm("Session expired. Refresh page to continue using the site?")&&e.login()};async function qe(e){const r=await fetch(Ve,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e}});let o={};try{console.log(r),r.ok&&(o=await r.json())}catch(n){console.log(n)}return o}function Xe(){const{token:e}=A.useContext(K.AuthContext),[r,o]=A.useState([]),[n,f]=A.useState([]);return A.useEffect(()=>{(async()=>{try{const a=await qe(e),c=a.userProfileMetadata;c&&c.attributes&&o(c.attributes),a&&a.attributes&&f(a.attributes)}catch(a){console.error("Error fetching user info:",a)}})()},[e]),s.jsx(s.Fragment,{children:r.map((t,a)=>t.name=="username"||t.name=="firstName"||t.name=="lastName"||t.name=="email"?s.jsx(s.Fragment,{}):s.jsxs("div",{className:"form-group",children:[s.jsxs("label",{className:"active control-label",htmlFor:t.name,children:[t.name,t.required&&s.jsx("span",{className:"required",children:" *"})]}),s.jsx("input",{type:"text",className:"form-control",id:t.name,name:t.name,required:t.required,disabled:t.readOnly,defaultValue:n[t.name]??""})]},a))})}function ze(){return s.jsx(s.Fragment,{children:s.jsx(K.AuthProvider,{authConfig:Je,children:s.jsx(Xe,{})})})}function Qe(e){const{kcContext:r,i18n:o,doUseDefaultCss:n,Template:f,classes:t}=e,{getClassName:a}=xe({doUseDefaultCss:n,classes:{...t,kcBodyClass:P(t==null?void 0:t.kcBodyClass,"user")}}),{url:c,realm:p,messagesPerField:g,stateChecker:m,account:d,referrer:j}=r,{msg:l}=o;return s.jsxs(f,{kcContext:r,i18n:o,doUseDefaultCss:n,classes:t,active:"account",children:[s.jsxs("div",{className:"row d-flex align-items-center",children:[s.jsx("div",{className:"col-md-8",children:s.jsx("h2",{children:l("editAccountHtmlTitle")})}),s.jsx("div",{className:"col-md-4 subtitle",children:s.jsxs("span",{className:"subtitle",children:[s.jsx("span",{className:"required",children:"*"})," ",l("requiredFields")]})})]}),s.jsxs("form",{action:c.accountUrl,className:"form-horizontal mt-3",method:"post",children:[s.jsx("nav",{children:s.jsxs("div",{className:"nav nav-tabs",id:"nav-tab",role:"tablist",children:[s.jsx("a",{className:"nav-item nav-link active",id:"nav-tab1-tab","data-bs-toggle":"tab",href:"#nav-tab1",role:"tab","aria-controls":"nav-tab1","aria-selected":"true",children:l("defaultAttributes")}),s.jsx("a",{className:"nav-item nav-link",id:"nav-tab2-tab","data-bs-toggle":"tab",href:"#nav-tab2",role:"tab","aria-controls":"nav-tab2","aria-selected":"false",children:l("additionalAttributes")})]})}),s.jsxs("div",{className:"tab-content pt-5",id:"nav-tabContent",children:[s.jsxs("div",{className:"tab-pane p-0 fade show active",id:"nav-tab1",role:"tabpanel","aria-labelledby":"nav-tab1-tab",children:[s.jsx("input",{type:"hidden",id:"stateChecker",name:"stateChecker",value:m}),!p.registrationEmailAsUsername&&s.jsx("div",{className:P("form-group",g.printIfExists("username","has-error")),children:s.jsxs("div",{className:"form-group",children:[s.jsx("label",{className:"active control-label",htmlFor:"username",children:l("username")}),p.editUsernameAllowed&&s.jsx("span",{className:"required",children:"*"}),s.jsx("input",{type:"text",className:"form-control",id:"username",name:"username",disabled:!p.editUsernameAllowed,defaultValue:d.username??""})]})}),s.jsxs("div",{className:P("form-group",g.printIfExists("email","has-error")),children:[s.jsx("label",{className:"active control-label",htmlFor:"email",children:l("email")}),s.jsx("input",{type:"text",className:"form-control",id:"email",name:"email",defaultValue:d.email??""})]}),s.jsxs("div",{className:P("form-group",g.printIfExists("lastName","has-error")),children:[s.jsx("label",{className:"active control-label",htmlFor:"firstName",children:l("firstName")}),s.jsx("input",{type:"text",className:"form-control",id:"firstName",name:"firstName",defaultValue:d.firstName??""})]}),s.jsxs("div",{className:P("form-group",g.printIfExists("lastName","has-error")),children:[s.jsx("label",{className:"active control-label",htmlFor:"lastName",children:l("lastName")}),s.jsx("input",{type:"text",className:"form-control",id:"lastName",name:"lastName",defaultValue:d.lastName??""})]})]}),s.jsx("div",{className:"tab-pane p-0 fade",id:"nav-tab2",role:"tabpanel","aria-labelledby":"nav-tab2-tab",children:s.jsx(ze,{})})]}),s.jsx("div",{className:"form-group d-flex justify-content-end",children:s.jsx("div",{id:"kc-form-buttons",className:"col-md-offset-2 col-md-10 submit",children:s.jsxs("div",{className:"d-flex justify-content-end align-items-center",children:[j!==void 0&&s.jsx("a",{className:"m-3",href:j==null?void 0:j.url,children:l("backToApplication")}),s.jsx("button",{type:"submit",className:P(a("kcButtonClass"),a("kcButtonDefaultClass"),a("kcButtonLargeClass"),"m-3"),name:"submitAction",value:"Cancel",children:l("doCancel")}),s.jsx("button",{type:"submit",className:P(a("kcButtonClass"),a("kcButtonPrimaryClass"),a("kcButtonLargeClass"),"m-3"),name:"submitAction",value:"Save",children:l("doSave")})]})})})]})]})}export{Qe as default};
//# sourceMappingURL=Account-2UYg42Xy.js.map
